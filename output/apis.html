<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Backend Development Textbook</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

  <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <style>

    .slide img[src$=svg] {
      width: 100%;
    }
  </style>
</head>
<body class="guide">
  <div>
    <a href="https://github.com/backend-development/backend-development-textbook/"><img style="position: fixed; top: 0; right: 0; border: 0; z-index: 10;" src="images/forkme.png" alt="Fork me on GitHub"></a>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">More Rails: </strong>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Rails Guides</a></li>
        <li class="more-info"><a href="https://curriculum.railsbridge.org/docs/">Railsbridge</a></li>
        <li class="more-info"><a href="https://railscasts.com/">Railscasts</a></li>
      </ul>
      <strong class="more-info-label">Beyond Backend: </strong>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://web-engineering.github.io/">Web Engineering</a></li>
      </ul>      
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Return to home page">Backend<span> Development</span></a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" onclick="guideMenu(); return false;" id="guidesMenu" class="guides-index-item nav-item">Index  &#x25BC;</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>Ruby on Rails</dt>
                <dd><a href="ruby_commandline.html">Ruby Commandline</a></dd>
                <dd><a href="rails_database_and_model.html">Database and Models</a></dd>
                <dd><a href="rails_associations_and_validations.html">Associations and Validations</a></dd>
                <dd><a href="rails_view_and_controller.html">Routing, View and Controller</a></dd>
                <dd><a href="rails_authentication.html">Authentication</a></dd>
                <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                <dd><a href="javascript_and_ajax.html">Javascript and AJAX</a></dd>
                <dd><a href="testing.html">Getting started with Testing</a></dd>
                <dd><a href="rails_gems.html">Ruby Gems for your Rails Project</a></dd>
                <dd><a href="apis.html">APIs</a></dd>
                <dd><a href="rails_websockets.html">Websocket in Rails</a></dd>
                <dd><a href="refactoring_rails.html">Refactoring Rails</a></dd>
                <dt>Overarching Concerns</dt>
                <dd><a href="security.html">Security</a></dd>
                <dd><a href="caching.html">Caching</a></dd>
                <dd><a href="advanced_testing.html">Advanced Testing</a></dd>
                <dd><a href="internationalization.html">Internationalization (I18n)</a></dd>
              </dl>
              <dl class="R">
                <dt>Nodes.js</dt>
                <dd><a href="node_vs_rails.html">Node vs. Rails</a></dd>
                <dd><a href="node_basics.html">Node Basics</a></dd>
                <dd><a href="node_websockets.html">Node Websockets</a></dd>
                <dd><a href="node_express.html">Node Web App</a></dd>
                <dd><a href="node_cluster.html">Scaling Node</a></dd>
              </dl>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2 id="preheader">no heading</h2>
                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#what-is-an-api">What is an API</a></li>
<li>
<a href="#rest">REST</a>

<ul>
<li><a href="#urls">URLS</a></li>
<li><a href="#hateoas">HATEOAS</a></li>
<li><a href="#http-methods-and-status-codes">HTTP Methods and Status Codes</a></li>
<li><a href="#multiple-representations">Multiple Representations</a></li>
<li><a href="#statelessness">Statelessness</a></li>
</ul>
</li>
<li><a href="#json-api">JSON API</a></li>
<li>
<a href="#rendering-json">Rendering JSON</a>

<ul>
<li><a href="#api-for-the-sample-app">API for the sample app</a></li>
<li><a href="#creating-json-with-erb">creating JSON with erb</a></li>
<li><a href="#creating-json-with-jbuilder">creating JSON with jbuilder</a></li>
<li><a href="#authentication">authentication</a></li>
</ul>
</li>
<li>
<a href="#stand-alone-api">Stand Alone API</a>

<ul>
<li><a href="#jsonapi-for-the-sample-app">JSONAPI for the sample app</a></li>
<li><a href="#creating-json-with-active-model-serializers">creating JSON with active_model_serializers</a></li>
</ul>
</li>
<li><a href="#documenting-an-api">Documenting an API</a></li>
<li><a href="#see-also">See Also</a></li>
</ol>

          </div>

      <div class="rest_header">
        
      </div>
    </div>
  </div>


  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <div class='slide'><a id='slide-1'></a>
</div>
<div class='slide'>
<a class='slide_break' id='slide-1' href='slides_apis.html#slide-1'>▻</a>
<h2>APIs</h2>
<p>After working through this guide you will:</p>
<ul>
<li>know about the thinking behind REST APIs and JSON API</li>
<li>be able to configure your existing controllers to offer resources as JSON</li>
<li>be able to set up an API for your rails app that is separate from existing controllers</li>
</ul>
<div class="repo"><p>You can study the <a href="https://github.com/backend-development/api_sample_app">code</a> and try out <a href="https://dry-cove-38472.herokuapp.com/">the demo</a> for the example described here.</p></div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-2' href='slides_apis.html#slide-2'>▻</a>
<hr>
</div>
<div class='slide'>
<a class='slide_break' id='slide-3' href='slides_apis.html#slide-3'>▻</a>
<h3 id="what-is-an-api">1 What is an API</h3>
<p>API stands for "Application Programming Interface". It is a set of clearly defined methods
of communication with a software component. So the objects and methods exposed by a library
form an API.</p>
<p>In Web development the acronym API is most
commonly used when the software component in question runs on a different server on the
Internet and is accessed via the network.</p>
<p>This Guide is concerned with APIs that you build and run using Ruby on Rails.</p>
</div>
<div class='slide'>
<a class='slide_break' id='slide-4' href='slides_apis.html#slide-4'>▻</a>
<h3 id="rest">2 REST</h3>
<p>The acronym REST was coined by Roy Fielding in his dissertation. When describing
the architecture of the web, and what made it so successfull on a technical level,
he desribed this architecture as "Representational State Transfer" (REST).</p>
<p>This Acronym was later picked up to describe a certain style of API,
and to distiguish such APIs from SOAP APIs.</p>
<p>A REST API allows to access and manipulate textual representations of Web resources using HTTP Methods and stateless operations.</p>
<p>"Web resources" were first defined on the World Wide Web as documents or files identified by their URLs, but today they have a much more generic and abstract definition encompassing every thing or entity that can be identified, named, addressed or handled, in any way whatsoever, on the Web.</p>
<p><a href="https://www.infoq.com/articles/rest-introduction">Tilkov(2007)</a> gives a brief introduction to REST. The main points are:</p>
<ol>
<li> Give every resource a unique URL</li>
<li> “Hypermedia as the engine of application state” (HATEOAS) - use URLs to reference other resources (not just ids)</li>
<li> Use HTTP Methods (and Status Codes) as intended.</li>
<li> One resource can have multiple representations, for example HTML, JSON and XML</li>
<li> Communicate statelessly - if possible!</li>
</ol>
</div>
<div class='slide'>
<a class='slide_break' id='slide-5' href='slides_apis.html#slide-5'>▻</a>
<h4 id="urls">2.1 URLS</h4>
<p>Give every resource a unique URL.
Please note that REST does not demand a certain form of URL.
While URLs with no parameters are often used:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
https://example.com/users/
https://example.com/users/1/
https://example.com/users/2/
https://example.com/users/3/

</pre>
</div>
<p>it is just as restful to use parameters:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
https://example.com/users.php
https://example.com/users.php?id=1
https://example.com/users.php?id=2
https://example.com/users.php?id=3

</pre>
</div>
<p>In REST, the URLs correspond to resources, which are represented by nouns.
This is a difference to SOAP, there there is typically just one endpoint:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
https://example.com/soap/router/

</pre>
</div>
<p>Through this endpoint you can access methods like <code>getUserData()</code> or <code>deleteUser()</code>.</p>
</div>
<div class='slide'>
<a class='slide_break' id='slide-6' href='slides_apis.html#slide-6'>▻</a>
<h4 id="hateoas">2.2 HATEOAS</h4>
<p>“Hypermedia as the engine of application state” means that a client interacts with a network application entirely through hypermedia, and needs no prior knowledge of URLs.</p>
<p>If an API returns the following JSON:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
{
    "id": "1",
    "name": "Example User",
    "email": "example@railstutorial.org"
    "profile_pics": [ 2, 5 ]
}

</pre>
</div>
<p>Then the Client needs to know how to get profile_pics from the API.
For example because the developer read the docs.</p>
<p>HATEOAS demands that the full URL is used to refer to other resources:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
{
    "id": "1",
    "name": "Example User",
    "email": "example@railstutorial.org"
    "profile_pics": [
       "https://sample.com/api/profile/pictures/2",
       "https://sample.com/api/profile/pictures/5"
    ]
}

</pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-7' href='slides_apis.html#slide-7'>▻</a>
<h4 id="http-methods-and-status-codes">2.3 HTTP Methods and Status Codes</h4>
<p>Use HTTP Methods (and Status Codes) as intended.</p>
<p>Regarding the HTTP Methods there are two important distinctions:</p>
<ul>
<li>the GET and HEAD methods should take no other action than retrieval. These methods ought to be considered <strong>safe</strong>.</li>
<li>The methods GET, HEAD, PUT and DELETE are idempotent: repeating the request will not change the end result (aside from error or expiration issues)</li>
</ul>
<p>The definition of the <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">Methods</a> in HTTP1.0 is just a short read, and worth its while!</p>
<p>References for status codes:</p>
<ul>
<li><a href="https://httpstatuses.com/422">Status codes</a></li>
<li><a href="https://http.cat/">Status cats</a></li>
</ul>
<p>When buidling a REST API, the HTTP Protocol already defines a lot
about that API. There is no need to come up with a way to delete
a resource, or to indicate failure. HTTP already offers the DELETE method
and status codes that indicate errors.</p>
</div>
<div class='slide'>
<a class='slide_break' id='slide-8' href='slides_apis.html#slide-8'>▻</a>
<h4 id="multiple-representations">2.4 Multiple Representations</h4>
<p>The same resource can be available in different formats.
There are two common ways of requesting different formats:</p>
<p>With the HTTP Header <code>Accept</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
GET /mini/person/83 HTTP/1.1
Host: example.com
Accept: application/xml

</pre>
</div>
<p>Or by adding an "extension" as part of the URL:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
https://example.com/mini/person/83.html
https://example.com/mini/person/83.xml
https://example.com/mini/person/83.json

</pre>
</div>
<p>The three different versions of person number 83 might look
like this: the HTML web page:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;h1&gt;Details zu einer Person&lt;/h1&gt;
&lt;p&gt;&lt;img src="https://example.com/mini/profil/edvard_1_2.jpg" /&gt;
Herr Edvard Paul Beisteiner hat insgesamt 4 Werke in dieser Datenbank.
Er hat den Usernamen fhs14287.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href='https://example.com/mini/werk/24'&gt;The Thin Red Line&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href='https://example.com/mini/werk/50'&gt;Der böse Wolf&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href='https://example.com/mini/werk/83'&gt;nimm zwei, schatz&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href='https://example.com/mini/werk/303'&gt;the neighbour.&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</pre>
</div>
<p>For an API the same resource might be represented as XML:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;person&gt;
  &lt;image ref='https://example.com/mini/profil/edvard_1_2.jpg' /&gt;
  &lt;vorname&gt;Edvard&lt;/vorname&gt;
  &lt;nachname&gt;Beisteiner&lt;/nachname&gt;
  &lt;username&gt;fhs14287&lt;/username&gt;
  &lt;werke&gt;
    &lt;werk ref='https://example.com/mini/werk/24'&gt;The Thin Red Line&lt;/werk&gt;
    &lt;werk ref='https://example.com/mini/werk/50'&gt;Der böse Wolf&lt;/werk&gt;
    &lt;werk ref='https://example.com/mini/werk/83'&gt;nimm zwei, schatz&lt;/werk&gt;
    &lt;werk ref='https://example.com/mini/werk/303'&gt;the neighbour.&lt;/werk&gt;
  &lt;/werke&gt;
&lt;/person&gt;

</pre>
</div>
<p>or as JSON:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
{"image":"https://example.com/mini/profil/edvard_1_2.jpg",
 "vorname":"Eduard",
 "nachname":"Beisteiner",
 "werk":[
    {"titel":"The Thin Red Line",
     "url":"https://example.com/mini/werk/24"},
    {"titel":"Der böse Wolf",
     "url":"https://example.com/mini/werk/50"},
    {"titel":"nimm zwei, schatz",
     "url":"https://example.com/mini/werk/83"},
    {"titel":"the neighbour.",
     "url":"https://example.com/mini/werk/303"}]}

</pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-9' href='slides_apis.html#slide-9'>▻</a>
<h4 id="statelessness">2.5 Statelessness</h4>
<p>Tilkov wirtes: "REST mandates that state be either turned into resource state, or kept on the client. In other words, a server should not have to retain some sort of communication state for any of the clients it communicates with beyond a single request."</p>
<p>This is important for performance and scalability and performance.<br>
 Statelessness makes caching easy. And in a scenario with serveral
servers behind a load balancer, not having state on the server means
the application will work if the requests bei one client are routest
to different servers.</p>
</div>
<div class='slide'>
<a class='slide_break' id='slide-10' href='slides_apis.html#slide-10'>▻</a>
<h3 id="json-api">3 JSON API</h3>
<p>When an API returns JSON data this could take many forms.
The <a href="https://jsonapi.org/">json:api specification</a> is a well thought out
convention for this.</p>
<p>It is especially good with the HATEOS aspect of REST.</p>
<p>The json:api specification adhers to this principle.</p>
</div>
<div class='slide'>
<a class='slide_break' id='slide-11' href='slides_apis.html#slide-11'>▻</a>
<h3 id="rendering-json">4 Rendering JSON</h3>
<p>Rails is equipped to not just create HTML as output, but to easily
offer other representations as well.</p>
<p>When you look at <code>rails routes</code> you can see that the routes created by
<code>resource :user</code> could contain an optional <code>format</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
                 Prefix Verb   URI Pattern                           Controller#Action
                   root GET    /                                     static_pages#home
                  users GET    /users(.:format)                      users#index
                   user GET    /users/:id(.:format)                  users#show

</pre>
</div>
<p>Only HTML is implemented by default. But we could use this feature
to have other formats:</p>
<ul>
<li><code>/users</code></li>
<li><code>/users.json</code></li>
<li><code>/users.xml</code></li>
<li><code>/users/1</code></li>
<li><code>/users/1.json</code></li>
<li><code>/users/1.xml</code></li>
</ul>
<p>When you try out accessing <code>/users/1.json</code> you get a response:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
406 Not Acceptable
Content-Length: 39
Content-Type: application/json; charset=utf-8

{"status":406,"error":"Not Acceptable"}

</pre>
</div>
<p>This error message is meant for a
client expecting JSON data. It uses both the HTTP status code
and the JSON to indicate the error.</p>
</div>
<div class='slide'>
<a class='slide_break' id='slide-12' href='slides_apis.html#slide-12'>▻</a>
<h4 id="api-for-the-sample-app">4.1 API for the sample app</h4>
<p>The "Frontend 1" in the example app expects a very simple JSON structure:</p>
<p>To display one user, it loads from <code>/user/1.json</code> and expects
a single JSON object with three attributes:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
{
   "id":1,
   "name":"Example User",
   "email":"example@railstutorial.org"
}

</pre>
</div>
<p>To display the table of users, it loads from <code>/users.json</code> and
expects a JSON array of objects like above:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
[
  {
    "id":2,
    "name":"Precious Heaney",
    "email":"example-1@railstutorial.org"
  },
  {
    "id":3,
    "name":"Warren Considine Sr.",
    "email":"example-2@railstutorial.org"
  }
]

</pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-13' href='slides_apis.html#slide-13'>▻</a>
<h4 id="creating-json-with-erb">4.2 creating JSON with erb</h4>
<p>We could create views using erb in <code>app/views/users/show.json.erb</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
{
  "id": &lt;%= @user.id %&gt;,
  "name": "&lt;%= @user.name %&gt;",
  "email": "&lt;%= @user.email %&gt;"
}

</pre>
</div>
<p>and <code>app/views/users/index.json.erb</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
[
&lt;%
  @users.each_with_index do |user| %&gt;
  {
    "id": &lt;%= user.id %&gt;,
    "name": "&lt;%= user.name %&gt;",
    "email": "&lt;%= user.email %&gt;"
  },
&lt;% end %&gt;
]

</pre>
</div>
<p>But wait, there's a problem: there is a comma after each object,
but there should be no comma after the last.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
[
&lt;%
  max = @users.length - 1
  @users.each_with_index do |user,i| %&gt;
  {
    "id": &lt;%= user.id %&gt;,
    "name": "&lt;%= user.name %&gt;",
    "email": "&lt;%= user.email %&gt;"
  }
  &lt;%= if i &lt; max then ',' end %&gt;
&lt;% end %&gt;
]

</pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-14' href='slides_apis.html#slide-14'>▻</a>
<h4 id="creating-json-with-jbuilder">4.3 creating JSON with jbuilder</h4>
<p>Formatting JSON would get quite repetitive if we need to create views for several resources.
We have not even touched on the problem of escaping: what happens
if a users name contains a quote? For example <kbd>Jack "the Ripper"</kbd>.
That would break our current view.</p>
<p>Rails 5 comes with the gem <code>jbuilder</code> which helps you create JSON, and
which handles all the escaping and formatting correctly.</p>
<p>We need to name the view <code>app/views/users/show.json.jbuilder</code>,
and then can use the the following code to extract three properties
from the user object:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
json.id @user.id
json.name @user.name
json.email @user.email

</pre>
</div>
<p>There is also a shorthand for this:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
json.extract! @user, :id, :name, :email

</pre>
</div>
<p>For the index view we want to create a JSON array.
In <code>app/views/users/index.json.jbuilder</code> we write:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
json.array! @users do |user|
  json.extract! user, :id, :name, :email
end

</pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-15' href='slides_apis.html#slide-15'>▻</a>
<h4 id="authentication">4.4 authentication</h4>
<p>All the authentication and access control we built into the
rails app before is still applicable to the JSON views.</p>
<p>In fact the scaffold generator always adds handling JSON responses
to the create, update and destroy actions of a controller.</p>
<p>For handling just HTML only this code would be needed:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
  # POST /users
  def create
    @user = User.new(user_params)
    if @user.save
      redirect_to @user, notice: 'User was successfully created.'
    else
      render :new
    end
    end
  end

</pre>
</div>
<p>But the scaffold generator also adds <code>resond_to</code> and <code>format</code> commands,
to handle json differently from html:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
  # POST /users
  # POST /users.json
  def create
    @user = User.new(user_params)
    respond_to do |format|
      if @user.save
        format.html { redirect_to @user, notice: 'User was successfully created.' }
        format.json { render :show, status: :created, location: @user }
      else
        format.html { render :new }
        format.json { render json: @user.errors, status: :unprocessable_entity }
      end
    end
  end

</pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-16' href='slides_apis.html#slide-16'>▻</a>
<h3 id="stand-alone-api">5 Stand Alone API</h3>
<p>To create a stand alone API we define new, separate routes under <code>/api/v1</code>.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
namespace :api do
  namespace :v1 do
    resources :users, only: [:index, :create, :show, :update, :destroy]
  end
end

</pre>
</div>
<p>we will be using the <code>active_model_serializers</code> gem for creating jsonapi:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
gem 'active_model_serializers'

</pre>
</div>
<p>this gem needs an initizalizer <code>config/initializers/active_model_serializers.rb</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
require 'active_model_serializers/register_jsonapi_renderer'

ActiveModelSerializers.config.adapter = :json_api

</pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-17' href='slides_apis.html#slide-17'>▻</a>
<h4 id="jsonapi-for-the-sample-app">5.1 JSONAPI for the sample app</h4>
<p>The "Frontend 2" in the example app expects the json to be formed
according to the json api specification.</p>
<p><code>/api/v1/user/1</code> will return data about one resource:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
{

    "data": {
        "id": "1",
        "type": "users",
        "attributes": {
            "name": "Example User",
            "email": "example@railstutorial.org"
        }
    }

}

</pre>
</div>
<p><code>/api/v1/users/</code> returns an array, but the top level JSON structure
is an object with on attribute <code>data</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
{

    "data": [
        {
            "id": "2",
            "type": "users",
            "attributes": {
                "name": "Precious Heaney",
                "email": "example-1@railstutorial.org"
            },
        },
        ...
    ]
}

</pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-18' href='slides_apis.html#slide-18'>▻</a>
<h4 id="creating-json-with-active-model-serializers">5.2 creating JSON with active_model_serializers</h4>
<p>After we defined the routes, we next need to create a controller.
As we are setting up a new hierarchy of controllers that will only
concerned with the API, it makes sense to inhert from <code>ActionController::API</code>,
not from <code>ActionController::Base</code>.</p>
<p>All the "normal" controllers first inhert from <code>ApplicationController</code>. We
will build a similar structure for the api controllers, the will inhert from
<code>Api::V1::BaseController</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
# app/controllers/api/v1/base_controller.rb

class Api::V1::BaseController &lt; ActionController::API
end

</pre>
</div>
<p>The users controller is the one that's actually called by the route:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
# app/controllers/api/v1/users_controller.rb

class Api::V1::UsersController &lt; Api::V1::BaseController
  def show
    user = User.find(params[:id])

    render jsonapi: user, serializer: Api::V1::UserSerializer
  end
end

</pre>
</div>
<p>The controller loads the right model, and then calls a <strong>serializer</strong> to
do the actual rendering of the json data.</p>
<p>The serializer needs to be defined in a separate file:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
# app/serializers/api/v1/user_serializer.rb

class Api::V1::UserSerializer &lt; ActiveModel::Serializer
  attributes(:name, :email)
end

</pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-19' href='slides_apis.html#slide-19'>▻</a>
<h3 id="documenting-an-api">6 Documenting an API</h3>
<p>See Halliday(2016): <a href="https://blog.codeship.com/producing-documentation-for-your-rails-api/">Producing Documentation for Your Rails API</a> for a discussion of automatic methods of documentation generation.</p>
</div>
<div class='slide'>
<a class='slide_break' id='slide-20' href='slides_apis.html#slide-20'>▻</a>
<h3 id="see-also">7 See Also</h3>
<ul>
<li>
<a href="https://www.ics.uci.edu/%7Efielding/pubs/dissertation/top.htm">Fielding, Roy(2000): Architectural Styles and the Design of Network-based Software Architectures</a>. Dissertation. University of California/Irvine, USA.</li>
<li><a href="https://martinfowler.com/articles/richardsonMaturityModel.html">Fowler (2010): Richardson Maturity Model</a></li>
<li><a href="https://www.infoq.com/articles/rest-introduction">Tilkov(2007): A Brief Introduction to REST</a></li>
<li><a href="https://edgeguides.rubyonrails.org/action_controller_overview.html#rendering-xml-and-json-data">Rails Guide: Rendering JSON in Action Controller Overview</a></li>
<li><a href="https://edgeguides.rubyonrails.org/api_app.html">Rails Guide: Using Rails for API-only Applications</a></li>
<li><a href="https://github.com/vasilakisfil/rails5_api_tutorial">Vasilakis(2017): Rails 5 API Tutorial</a></li>
<li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">Methods HTTP/1.0</a></li>
<li><a href="https://httpstatuses.com/422">Status codes</a></li>
<li>
<a href="https://github.com/nsarno/knock">gem knock</a> for token based authentication for API only Rails apps</li>
</ul>
</div>        
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p class="copyright">published under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/at/deed.de">creative commons by-nc-sa</a> in 2012-2016 by <a href="https://brigitte-jellinek.at">Brigitte Jellinek</a>.
      </p><p>If you want to contribute: <a href="https://github.com/backend-development/backend-development-textbook/fork">fork the source on github</a>
        and edit <a href="https://github.com/backend-development/backend-development-textbook/blob/master/source/apis.md">apis.md</a>
      </p>
    </div>
  </div>

  <script src="javascripts/jquery.min.js"></script>
  <script src="javascripts/responsive-tables.js"></script>
  <script src="javascripts/guides.js"></script>
  <script src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script>
    SyntaxHighlighter.all()
    $(guidesIndex.bind);
    $(document).ready(function(){
      let hash = document.location.hash;
      if(! hash) return;
      document.getElementById(hash.substr(1)).scrollIntoView(true);
    })
  </script>
  </body>
</html>
